{
  "version": 2,
  "repository": "rushwing/goal-agent",
  "workers": [
    "claude",
    "gemini",
    "kimi",
    "minimax"
  ],
  "labels": {
    "owner": [
      "llm-owner:claude",
      "llm-owner:gemini",
      "llm-owner:kimi",
      "llm-owner:minimax"
    ],
    "reviewer": [
      "llm-reviewer:claude",
      "llm-reviewer:gemini",
      "llm-reviewer:kimi",
      "llm-reviewer:minimax"
    ],
    "queue": [
      "queue:ready-impl",
      "queue:impl-active",
      "queue:in-pr",
      "queue:review-active",
      "queue:approved",
      "queue:needs-human",
      "queue:blocked",
      "queue:done"
    ]
  },
  "queue_rules": {
    "exactly_one_queue_label": true,
    "default_lease_hours": 24,
    "do_not_claim_if_labels_present": [
      "queue:impl-active",
      "queue:review-active"
    ]
  },
  "merge_policy": {
    "note": "All PRs must be merged by the human maintainer. LLM workers share the same GitHub account as the owner and cannot self-merge. Reviewers signal approval via queue:approved; the human performs the actual GitHub merge; the LLM then handles post-merge housekeeping (queue:approved â†’ queue:done + close issue), ideally triggered by the pull_request:closed+merged event."
  },
  "transitions": {
    "queue:ready-impl":    ["queue:impl-active"],
    "queue:impl-active":   ["queue:in-pr", "queue:needs-human", "queue:blocked"],
    "queue:in-pr":         ["queue:review-active"],
    "queue:review-active": ["queue:approved", "queue:ready-impl", "queue:in-pr", "queue:needs-human"],
    "queue:approved":      ["queue:done"],
    "queue:needs-human":   ["queue:ready-impl", "queue:in-pr"],
    "queue:blocked":       ["queue:ready-impl"],
    "queue:done":          []
  },
  "transition_notes": {
    "queue:review-active -> queue:approved":   "reviewer approved; human must merge the PR",
    "queue:approved      -> queue:done":       "LLM sets this after detecting PR merged (pull_request:closed+merged event); human must have merged first",
    "queue:review-active -> queue:ready-impl": "changes requested; re-opens for a new impl claim",
    "queue:review-active -> queue:in-pr":      "reviewer releases claim without a result; back to waiting for reviewer",
    "queue:review-active -> queue:needs-human":"review blocked on human judgment",
    "queue:needs-human   -> queue:ready-impl": "human resolved an implementation blocker",
    "queue:needs-human   -> queue:in-pr":      "human resolved a review-stage blocker",
    "queue:blocked       -> queue:ready-impl": "upstream dependency resolved"
  },
  "claim_comment": {
    "header": "[bot-claim]",
    "required_fields": [
      "worker",
      "claimed_at",
      "lease_hours"
    ],
    "optional_fields": [
      "branch"
    ],
    "note": "role is now implicit in the queue label (impl-active = implementer, review-active = reviewer) and does not need to be stated in the comment"
  },
  "review_comment": {
    "header": "[bot-review]",
    "required_fields": [
      "worker",
      "reviewed_at",
      "result",
      "pr"
    ],
    "optional_fields": [
      "notes"
    ],
    "allowed_results": [
      "approved",
      "changes_requested",
      "blocked"
    ]
  },
  "blocked_comment": {
    "header": "[bot-blocked]",
    "recommended_fields": [
      "reason",
      "next_check"
    ]
  },
  "routing_defaults": {
    "implementer": [
      {
        "when_labels_any": [
          "security"
        ],
        "owner": "claude"
      },
      {
        "when_labels_any": [
          "backend",
          "data-integrity"
        ],
        "owner": "claude"
      },
      {
        "when_labels_any": [
          "enhancement"
        ],
        "title_matches_any": [
          "Telegram",
          "bot",
          "CI",
          "DX",
          "pyproject",
          "uv"
        ],
        "owner": "gemini"
      }
    ],
    "reviewer": [
      {
        "when_labels_any": [
          "security"
        ],
        "reviewers": [
          "minimax"
        ]
      },
      {
        "when_labels_any": [
          "data-integrity"
        ],
        "reviewers": [
          "minimax"
        ]
      },
      {
        "title_matches_any": [
          "Telegram",
          "prompt",
          "report"
        ],
        "reviewers": [
          "kimi"
        ]
      },
      {
        "when_labels_any": [
          "backend"
        ],
        "title_matches_any": [
          "CI",
          "DX",
          "pyproject",
          "uv"
        ],
        "reviewers": [
          "claude"
        ]
      }
    ]
  }
}
